{% extends 'base.html' %}

{% block title %}LLM Settings{% endblock %}

{% block content %}
<h1 class="mb-4">LLM Settings</h1>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">OpenAI Configuration</h5>
            </div>
            <div class="card-body">
                <form action="{{ url_for('llm_settings') }}" method="POST">
                    <div class="mb-3">
                        <label for="api_key" class="form-label">OpenAI API Key</label>
                        <input type="password" class="form-control" id="api_key" name="api_key" value="{{ api_key }}" required>
                        <div class="form-text">Your OpenAI API key for accessing GPT models</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="temperature" class="form-label">Temperature: <span id="temperatureValue">{{ temperature }}</span></label>
                        <div class="range-slider-wrapper">
                            <input type="range" class="form-range" id="temperature" name="temperature" min="0" max="2" step="0.1" value="{{ temperature }}" oninput="updateTemperatureValue(this.value)">
                        </div>
                        <div class="form-text">Controls randomness: lower values make responses more focused and deterministic, higher values make responses more creative and varied</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="max_tokens" class="form-label">Max Tokens: <span id="maxTokensValue">{{ max_tokens }}</span></label>
                        <div class="range-slider-wrapper">
                            <input type="range" class="form-range" id="max_tokens" name="max_tokens" min="100" max="4000" step="50" value="{{ max_tokens }}" oninput="updateMaxTokensValue(this.value)">
                        </div>
                        <div class="form-text">Maximum length of response in tokens (1 token â‰ˆ 4 characters in English)</div>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="submit" class="btn btn-primary">Save Settings</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">API Test</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="test_message" class="form-label">Test Message</label>
                    <input type="text" class="form-control" id="test_message" placeholder="Enter a message to test the API">
                </div>
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <button type="button" class="btn btn-outline-primary" id="testApiBtn" onclick="testApi()">Test API</button>
                </div>
                <div class="mt-3 d-none" id="testResult">
                    <h6>Response:</h6>
                    <div class="p-3 bg-dark rounded" id="responseText"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function updateTemperatureValue(value) {
    document.getElementById('temperatureValue').textContent = value;
}

function updateMaxTokensValue(value) {
    document.getElementById('maxTokensValue').textContent = value;
}

function testApi() {
    const message = document.getElementById('test_message').value;
    if (!message) {
        alert('Please enter a message to test');
        return;
    }
    
    const testBtn = document.getElementById('testApiBtn');
    testBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Testing...';
    testBtn.disabled = true;
    
    fetch('/api/chat', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            message: message
        })
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById('responseText').textContent = data.response;
        document.getElementById('testResult').classList.remove('d-none');
        testBtn.innerHTML = 'Test API';
        testBtn.disabled = false;
    })
    .catch(error => {
        document.getElementById('responseText').textContent = 'Error: ' + error.message;
        document.getElementById('testResult').classList.remove('d-none');
        testBtn.innerHTML = 'Test API';
        testBtn.disabled = false;
    });
}
</script>
{% endblock %}